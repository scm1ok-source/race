<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Simple Race ‚Äî 7 Teams</title>
<style>
  :root {
    --line:#e5e7eb; --bg:#ffffff; --text:#111827; --muted:#6b7280; --accent:#2563eb;
    --lane:#f9fafb; --track:#1f3346; --pit:#fef3c7; --pitb:#f59e0b;
  }
  *{box-sizing:border-box} body{margin:0;font-family:Inter,system-ui,Segoe UI,Roboto,Arial}
  header{position:sticky;top:0;background:#fff;border-bottom:1px solid var(--line);padding:10px 14px;z-index:5}
  header .row{display:flex;gap:16px;align-items:center;justify-content:space-between}
  .controls button{padding:8px 12px;border:1px solid var(--line);border-radius:10px;background:#fff;cursor:pointer}
  .controls button:hover{border-color:var(--accent)}
  main{display:grid;grid-template-columns:1fr 320px;gap:16px;padding:16px}
  @media(max-width:960px){main{grid-template-columns:1fr}}
  /* –¢—Ä–µ–∫ + –¥–æ—Ä–æ–∂–∫–∏ */
  .panel{background:#fff;border:1px solid var(--line);border-radius:14px;padding:14px}
  .track{position:relative; padding:10px 10px 6px 10px}
  .lane{position:relative;height:58px;margin:10px 0;background:var(--lane);border:1px dashed var(--line);border-radius:12px;overflow:hidden}
  .lane-label{position:absolute;left:8px;top:8px;font-weight:600;color:var(--text);font-size:14px}
  .lane .car{position:absolute;left:0;top:50%;transform:translate(-50%,-50%); /* -50% —á—Ç–æ–±—ã ¬´–Ω–æ—Å¬ª —Ä–æ–≤–Ω—è–ª—Å—è –ø–æ –ø—Ä–æ–≥—Ä–µ—Å—Å—É */
             display:flex;align-items:center;gap:6px;transition:left 300ms linear}
  .car .icon{width:36px;height:24px;border-radius:4px;display:inline-block}
  .car .num{position:absolute;left:10px;top:3px;color:#fff;font-weight:700;font-size:12px;text-shadow:0 1px 1px rgba(0,0,0,.4)}
  .car .meta{font-size:12px;color:var(--muted)}
  .pit{position:absolute;right:10px;top:50%;transform:translateY(-50%);width:60px;height:36px;background:var(--pit);
       border:2px solid var(--pitb);border-radius:8px;opacity:.85}
  /* –≠—Ç–∞–ø—ã */
  .stages{display:flex;gap:6px;align-items:center}
  .stage-dot{width:12px;height:12px;border-radius:50%;background:#e5e7eb}
  .stage-dot.active{background:#10b981}
  /* –õ–∏–¥–µ—Ä–±–æ—Ä–¥ */
  aside.panel h3{margin:8px 0 10px}
  .leader{list-style:none;margin:0;padding:0}
  .leader li{display:flex;justify-content:space-between;gap:8px;padding:8px;border-bottom:1px dashed var(--line)}
  .badge{display:inline-flex;align-items:center;justify-content:center;width:22px;height:22px;border-radius:50%;color:#fff;font-weight:700;font-size:12px;margin-right:6px}
  .quick{display:grid;grid-template-columns:repeat(3,1fr);gap:8px;margin-top:12px}
  .quick button{padding:6px 8px;border:1px solid var(--line);border-radius:8px;background:#fff;cursor:pointer}
  .quick button:hover{border-color:var(--accent)}
  .muted{color:var(--muted)}
  /* –ü–∏—Ç-—Å—Ç–æ–ø —ç—Ñ—Ñ–µ–∫—Ç */
  @keyframes pitPulse{0%{transform:translate(-50%,-50%) scale(1)}50%{transform:translate(-50%,-50%) scale(1.08)}100%{transform:translate(-50%,-50%) scale(1)}}
  .car.pit{animation:pitPulse 700ms ease-in-out}
</style>
</head>
<body>
<header>
  <div class="row">
    <div style="display:flex;gap:16px;align-items:center">
      <div><strong>–°–µ—Å—Å–∏—è:</strong> <span id="t-session">60:00</span></div>
      <div class="stages"><strong style="margin-right:6px">–≠—Ç–∞–ø:</strong>
        <div id="s1" class="stage-dot active"></div>
        <div id="s2" class="stage-dot"></div>
        <div id="s3" class="stage-dot"></div>
        <div id="s4" class="stage-dot"></div>
      </div>
    </div>
    <div class="controls">
      <button id="start">‚ñ∂ –°—Ç–∞—Ä—Ç</button>
      <button id="pause">‚è∏ –ü–∞—É–∑–∞</button>
      <button id="next">‚è≠ –°–ª–µ–¥—É—é—â–∏–π —ç—Ç–∞–ø</button>
      <button id="reset">üîÑ –°–±—Ä–æ—Å</button>
    </div>
  </div>
</header>

<main>
  <section class="panel">
    <h3 style="margin:0 0 8px">–¢—Ä–∞—Å—Å–∞</h3>
    <div class="track" id="track">
      <!-- 7 –¥–æ—Ä–æ–∂–µ–∫ –≥–µ–Ω–µ—Ä–∏—Ä—É—é—Ç—Å—è —Å–∫—Ä–∏–ø—Ç–æ–º -->
    </div>
    <div class="muted" style="font-size:12px;margin-top:6px">–ü–æ–¥—Å–∫–∞–∑–∫–∞: –∫–ª–∏–∫ –ø–æ –±–æ–ª–∏–¥—É = –ø–∏—Ç-—Å—Ç–æ–ø (+10)</div>
  </section>

  <aside class="panel">
    <h3>–õ–∏–¥–µ—Ä–±–æ—Ä–¥</h3>
    <ol id="leader" class="leader"></ol>
    <div class="quick">
      <button data-team="1">+5 T1</button><button data-team="2">+5 T2</button><button data-team="3">+5 T3</button>
      <button data-team="4">+5 T4</button><button data-team="5">+5 T5</button><button data-team="6">+5 T6</button>
      <button data-team="7">+5 T7</button>
    </div>
    <p class="muted" style="margin-top:8px">–û—á–∫–∏ ‚Üí –ø–æ–∑–∏—Ü–∏—è –Ω–∞ –¥–æ—Ä–æ–∂–∫–µ. –î–æ—à—ë–ª –¥–æ 100% ‚Äî –ø–æ–ª–Ω—ã–π –∫—Ä—É–≥, —Å—á—ë—Ç—á–∏–∫ ¬´laps¬ª —Ä–∞—Å—Ç—ë—Ç.</p>
  </aside>
</main>

<script>
(function(){
  // ====== –î–ê–ù–ù–´–ï ======
  const model = {
    duration: 60*60,    // 60 –º–∏–Ω—É—Ç
    time: 0,            // —Å–µ–∫—É–Ω–¥—ã
    running: false,
    stage: 1,
    stages: 4,
    maxPointsPerLap: 100,  // 100 –æ—á–∫–æ–≤ = –ø–æ–ª–Ω—ã–π –∫—Ä—É–≥
    teams: [
      {id:1,name:'Team 1',color:'#ef4444',points:0,laps:0},
      {id:2,name:'Team 2',color:'#2563eb',points:0,laps:0},
      {id:3,name:'Team 3',color:'#10b981',points:0,laps:0},
      {id:4,name:'Team 4',color:'#f59e0b',points:0,laps:0},
      {id:5,name:'Team 5',color:'#8b5cf6',points:0,laps:0},
      {id:6,name:'Team 6',color:'#14b8a6',points:0,laps:0},
      {id:7,name:'Team 7',color:'#e11d48',points:0,laps:0},
    ],
  };

  // ====== –†–ï–ù–î–ï–† –î–û–†–û–ñ–ï–ö ======
  const track = document.getElementById('track');
  function renderLanes(){
    track.innerHTML = '';
    model.teams.forEach(t=>{
      const lane = document.createElement('div'); lane.className='lane'; lane.dataset.team=t.id;
      const label = document.createElement('div'); label.className='lane-label'; label.innerHTML =
        `<span class="badge" style="background:${t.color}">${t.id}</span> ${t.name}`;
      const pit = document.createElement('div'); pit.className='pit';
      const car = document.createElement('div'); car.className='car'; car.dataset.team=t.id;
      const icon = document.createElement('span'); icon.className='icon'; icon.style.background=t.color;
      const num = document.createElement('span'); num.className='num'; num.textContent=t.id;
      const meta = document.createElement('span'); meta.className='meta'; meta.textContent='0 pts ‚Ä¢ 0 laps';
      car.appendChild(icon); car.appendChild(num); car.appendChild(meta);
      // –∫–ª–∏–∫ –ø–æ –±–æ–ª–∏–¥—É = –ø–∏—Ç-—Å—Ç–æ–ø –±–æ–Ω—É—Å
      car.addEventListener('click', ()=>{ addPoints(t.id, 10); pitEffect(t.id); });

      lane.appendChild(label); lane.appendChild(pit); lane.appendChild(car);
      track.appendChild(lane);
    });
  }

  // ====== –û–ë–ù–û–í–õ–ï–ù–ò–ï –ü–û–ó–ò–¶–ò–ô ======
  function setCarPosition(team){
    const lane = track.querySelector(`.lane[data-team="${team.id}"]`);
    const car  = lane.querySelector('.car');
    const pct  = (team.points % model.maxPointsPerLap) / model.maxPointsPerLap * 100; // 0..100
    car.style.left = pct + '%';
    const laps = Math.floor(team.points / model.maxPointsPerLap);
    team.laps = laps;
    lane.querySelector('.meta').textContent = `${team.points} pts ‚Ä¢ ${team.laps} laps`;
  }
  function updateAll(){
    model.teams.forEach(setCarPosition);
    renderLeaderboard();
    updateHeader();
  }

  // ====== –õ–ò–î–ï–†–ë–û–†–î ======
  const leader = document.getElementById('leader');
  function renderLeaderboard(){
    const sorted = [...model.teams].sort((a,b)=>{
      // —Å–æ—Ä—Ç–∏—Ä—É–µ–º –ø–æ –æ–±—â–µ–º—É –ø—Ä–æ–≥—Ä–µ—Å—Å—É: laps*100 + –æ—Å—Ç–∞—Ç–æ–∫
      const ap = a.laps*100 + (a.points % model.maxPointsPerLap);
      const bp = b.laps*100 + (b.points % model.maxPointsPerLap);
      return bp - ap;
    });
    leader.innerHTML = '';
    sorted.forEach((t, i)=>{
      const li = document.createElement('li');
      li.innerHTML = `<span><span class="badge" style="background:${t.color}">${i+1}</span> <strong>${t.name}</strong></span>
                      <span>${t.points} pts</span>`;
      leader.appendChild(li);
    });
  }

  // ====== –í–†–ï–ú–Ø/–≠–¢–ê–ü–´ ======
  const tEl = document.getElementById('t-session');
  function updateHeader(){
    const remain = Math.max(0, model.duration - Math.floor(model.time));
    const mm = String(Math.floor(remain/60)).padStart(2,'0');
    const ss = String(remain%60).padStart(2,'0');
    tEl.textContent = `${mm}:${ss}`;
    for(let i=1;i<=model.stages;i++){
      const el = document.getElementById('s'+i);
      if(!el) continue;
      el.classList.toggle('active', i<=model.stage);
    }
  }

  // ====== –û–ß–ö–ò / –î–ï–ô–°–¢–í–ò–Ø ======
  function addPoints(teamId, delta){
    const t = model.teams.find(x=>x.id===teamId); if(!t) return;
    t.points = Math.max(0, t.points + delta);
    setCarPosition(t); renderLeaderboard();
  }
  function pitEffect(teamId){
    const car = track.querySelector(`.lane[data-team="${teamId}"] .car`);
    car.classList.remove('pit'); void car.offsetWidth; car.classList.add('pit');
  }

  // –ë—ã—Å—Ç—Ä—ã–µ +5
  document.querySelectorAll('.quick button').forEach(b=>{
    b.addEventListener('click', ()=> addPoints(+b.dataset.team, 5));
  });

  // –ö–æ–Ω—Ç—Ä–æ–ª—ã
  document.getElementById('start').onclick = ()=> model.running = true;
  document.getElementById('pause').onclick = ()=> model.running = false;
  document.getElementById('next').onclick  = ()=> { model.stage = Math.min(model.stages, model.stage+1); updateHeader(); };
  document.getElementById('reset').onclick = ()=> {
    model.time=0; model.running=false; model.stage=1;
    model.teams.forEach(t=>{ t.points=0; t.laps=0; });
    updateAll();
  };

  // ====== –õ–£–ü –¢–û–õ–¨–ö–û –î–õ–Ø –¢–ê–ô–ú–ï–†–ê (–ø–æ–∑–∏—Ü–∏–∏ —Å—á–∏—Ç–∞—é—Ç—Å—è –ø–æ –æ—á–∫–∞–º –º–≥–Ω–æ–≤–µ–Ω–Ω–æ) ======
  let last = performance.now();
  function loop(now){
    const dt = Math.min(1,(now-last)/1000); last=now;
    if(model.running){
      model.time = Math.min(model.duration, model.time + dt);
      if(model.time>=model.duration) model.running=false;
      updateHeader();
    }
    requestAnimationFrame(loop);
  }

  // INIT
  renderLanes();
  updateAll();
  requestAnimationFrame(loop);
})();
</script>
</body>
</html>
